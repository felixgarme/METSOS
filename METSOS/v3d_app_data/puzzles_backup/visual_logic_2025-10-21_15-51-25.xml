<xml xmlns="http://www.w3.org/1999/xhtml">
  <tab name="Init" type="InitTab" active="false" scrollx="1602.75" scrolly="0.25" scale="0.9"></tab>
  <tab name="New Tab" type="CommonTab" active="true" scrollx="655.5" scrolly="-530.75" scale="1">
    <block xmlns="https://developers.google.com/blockly/xml" type="connectorSlot" id="-iJ-sL6.kR)?;Mpp(@2j" x="-315" y="324">
      <statement name="DO">
        <block type="execScript" id="#kQNJYlTDnyY..(9!!Nn">
          <value name="TEXT">
            <shadow type="textMultiline" id="wf%u4x(BiO0H_{79BMS1">
              <field name="HIGHLIGHT_MODE">javascript</field>
              <field name="TEXT" editor-height="4" editor-width="475">window.app = app; &amp;#10;import("./imports.js");&amp;#10;</field>
            </shadow>
          </value>
          <next>
            <block type="addFog" id="FVk}t5;mlBJQDQfIR^[s">
              <mutation xmlns="http://www.w3.org/1999/xhtml" has_near_far_opts="true"></mutation>
              <value name="R">
                <shadow type="math_number" id="Hfe~cSLgc?o?LK;af#K5">
                  <field name="NUM">185</field>
                </shadow>
              </value>
              <value name="G">
                <shadow type="math_number" id="[6Uv].E.F)pZ!UIv)vjy">
                  <field name="NUM">200</field>
                </shadow>
              </value>
              <value name="B">
                <shadow type="math_number" id="~S@^1^yC~%njxx7:#D6r">
                  <field name="NUM">215</field>
                </shadow>
              </value>
              <value name="NEAR">
                <shadow type="math_number" id="VxC(JWvBT{Apz^Y[]3?B">
                  <field name="NUM">1</field>
                </shadow>
              </value>
              <value name="FAR">
                <shadow type="math_number" id="#AQtMkI/Mya`9;mEv.~$">
                  <field name="NUM">10000</field>
                </shadow>
              </value>
              <next>
                <block type="procedures_callnoreturn" id="m!bWZ!.%biYm^adol?zF">
                  <mutation name="posA"></mutation>
                </block>
              </next>
            </block>
          </next>
        </block>
      </statement>
    </block>
    <block xmlns="https://developers.google.com/blockly/xml" type="procedures_defnoreturn" id="4iT;w8]li-X^rtaqfc7C" x="-295" y="656">
      <field name="NAME">posA</field>
      <comment pinned="false" h="80" w="160">Describe this function...</comment>
      <statement name="STACK">
        <block type="tweenCameraExt" id="o(rG5;GdCdJP|g4dYc[h">
          <mutation xmlns="http://www.w3.org/1999/xhtml" whenfinishedslot="false"></mutation>
          <field name="MOVEMENT_TYPE">LINEAR</field>
          <value name="POSITION">
            <block type="objectList" id="GD=I+{ha3):bn:*AFi}p">
              <field name="FIELDNAME">A</field>
            </block>
          </value>
          <value name="LOOKAT">
            <block type="objectList" id="2]/u8,4ca5{tY2`]fX^0">
              <field name="FIELDNAME">general</field>
            </block>
          </value>
          <value name="DURATION">
            <shadow type="math_number" id="l@0v:?8,JG_OR!CAn$H:">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <next>
            <block type="setTimeout" id="Ft=o4]D@(voFI1aCE^VC">
              <value name="VALUE">
                <shadow type="math_number" id="rd3Rcz]Wb,.ssd:F)zc^">
                  <field name="NUM">1</field>
                </shadow>
              </value>
              <statement name="DO">
                <block type="execScript" id="V*1g#eov6j3)0OX[,`cy">
                  <value name="TEXT">
                    <shadow type="textMultiline" id="5SbIn2z6`+iv{r3v1G{w">
                      <field name="HIGHLIGHT_MODE">javascript</field>
                      <field name="TEXT" editor-height="21" editor-width="762.5">// Suponemos que `app` es tu instancia de Verge3D&amp;#10;const camera = app.camera;&amp;#10;const controls = app.controls;&amp;#10;&amp;#10;if (!camera) {&amp;#10;  console.warn("Cámara no encontrada");&amp;#10;} &amp;#10;if (!controls) {&amp;#10;  console.warn("Controles de cámara no encontrados");&amp;#10;}&amp;#10;&amp;#10;const dir = new v3d.Vector3();&amp;#10;camera.getWorldDirection(dir);&amp;#10;&amp;#10;// Umbral para “mirando al suelo”:&amp;#10;if (dir.y &lt; -0.5) {&amp;#10;  // Verificamos que exista target&amp;#10;  let target = controls.target;&amp;#10;  if (!target) {&amp;#10;    // Si no hay target, creamos uno o asumimos la posición cero&amp;#10;    target = new v3d.Vector3(0, 0, 0);&amp;#10;    console.warn("controls.target indefinido — usando (0,0,0) como target");&amp;#10;  }&amp;#10;  &amp;#10;  // Calculamos la nueva posición para rotar 180° alrededor del eje Y&amp;#10;  const pos = camera.position.clone().sub(target);&amp;#10;  &amp;#10;  const angle = Math.PI;  &amp;#10;  const cosA = Math.cos(angle);&amp;#10;  const sinA = Math.sin(angle);&amp;#10;  &amp;#10;  const newX = pos.x * cosA - pos.z * sinA;&amp;#10;  const newZ = pos.x * sinA + pos.z * cosA;&amp;#10;  &amp;#10;  pos.x = newX;&amp;#10;  pos.z = newZ;&amp;#10;  &amp;#10;  camera.position.copy(target).add(pos);&amp;#10;  camera.lookAt(target);&amp;#10;  &amp;#10;  // Luego actualizar controles&amp;#10;  if (typeof controls.update === "function") {&amp;#10;    controls.update();&amp;#10;  } else {&amp;#10;    console.warn("controls.update() no disponible");&amp;#10;  }&amp;#10;}&amp;#10;</field>
                    </shadow>
                  </value>
                </block>
              </statement>
            </block>
          </next>
        </block>
      </statement>
    </block>
  </tab>
  <editorsettings viewport-x="1180.1999999999998" viewport-y="37" viewport-w="798.8" viewport-h="448.5" viewport-hidden="true" toolbox-library-mode="false" toolbox-minimized-mode="false"></editorsettings>
</xml>